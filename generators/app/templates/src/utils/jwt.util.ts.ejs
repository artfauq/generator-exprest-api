import jwt from 'jsonwebtoken';
import { config } from '../config';
import { JWTPayload } from '../types';
import { generateUUID } from './string.util';

/**
 * Returns the secret used to sign a JWT token.
 */
export const getJwtSecret = (passwordHash: string): string => config.secret + passwordHash;

/**
 * Generates and returns a signed JWT.
 */
export const generateSignedJWT = (
  userId: string,
  passwordHash: string,
  payload: JWTPayload,
): string => {
  const secret = getJwtSecret(passwordHash);

  return jwt.sign(payload, secret, {
    algorithm: 'HS256',
    issuer: config.publicHost,
    subject: userId,
    jwtid: generateUUID(),
  });
};
